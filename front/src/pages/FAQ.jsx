import { useState } from 'react';
import { Link } from 'react-router-dom';
import { ChevronDown, Brain, Calendar, Target, BookOpen, Zap, HelpCircle, Sparkles, ArrowLeft, Home } from 'lucide-react';

const FAQ = () => {
  const [openIndex, setOpenIndex] = useState(null);

  const toggleQuestion = (index) => {
    setOpenIndex(openIndex === index ? null : index);
  };

  const sections = [
    {
      title: 'Основы работы',
      icon: HelpCircle,
      color: 'blue',
      questions: [
        {
          question: 'Что такое Memora?',
          answer: 'Memora — это платформа для эффективного запоминания информации с помощью метода интервального повторения. Система автоматически планирует повторения карточек в оптимальное время, чтобы вы запоминали материал надолго. Основана на научно доказанном алгоритме SM-2 (SuperMemo 2).'
        },
        {
          question: 'Как начать пользоваться?',
          answer: 'Зарегистрируйтесь и создайте первую колоду в разделе "Колоды". Добавьте карточки с вопросами (лицевая сторона) и ответами (обратная сторона). Нажмите "Начать обучение" — система покажет карточки и попросит оценить, насколько хорошо вы их помните. На основе ваших оценок алгоритм автоматически запланирует следующие повторения.'
        },
        {
          question: 'Чем отличается обучение от тренировки?',
          answer: 'Режим обучения использует алгоритм SM-2 для планирования повторений, отслеживает прогресс, начисляет очки и поддерживает серию дней. Режим тренировки — это свободный просмотр карточек без сохранения статистики и влияния на расписание. Тренировка полезна для быстрого ознакомления с новым материалом или повторения без давления.'
        },
        {
          question: 'Бесплатна ли платформа?',
          answer: 'Да, Memora полностью бесплатна. Вы можете создавать неограниченное количество колод и карточек, пользоваться всеми функциями без ограничений. Мы верим, что качественное образование должно быть доступным каждому.'
        }
      ]
    },
    {
      title: 'Алгоритм SM-2',
      icon: Brain,
      color: 'purple',
      questions: [
        {
          question: 'Что такое алгоритм SM-2?',
          answer: 'SM-2 (SuperMemo 2) — это научно обоснованный алгоритм интервального повторения, разработанный Петром Возняком в 1988 году. Он определяет оптимальные интервалы между повторениями на основе того, насколько хорошо вы помните материал. Алгоритм учитывает "кривую забывания" Германа Эббингауза: мы забываем информацию с предсказуемой скоростью, но каждое повторение замедляет забывание.'
        },
        {
          question: 'Как работают интервалы повторения?',
          answer: 'При первом успешном повторении карточка появится через 1 день, при втором — через 6 дней. Затем интервал умножается на ease factor (обычно 2.5), то есть ~15 дней, потом ~37 дней, ~93 дня и так далее. Если вы забыли карточку (оценка 1), интервал сбрасывается до 10 минут, и процесс начинается заново. Это гарантирует, что сложные карточки повторяются чаще.'
        },
        {
          question: 'Что означают оценки карточек?',
          answer: '1 (Забыл) — не смогли вспомнить ответ даже после подсказки. Интервал сбрасывается до 10 минут, карточка станет "новой". 2 (Сложно) — вспомнили с большим трудом или после долгих раздумий. Ease factor уменьшается на 0.15, интервал растёт медленнее. 3 (Хорошо) — вспомнили нормально, без особых затруднений. Стандартное увеличение интервала. 4 (Легко) — ответ пришёл мгновенно, без усилий. Ease factor увеличивается на 0.15, интервал растёт быстрее.'
        },
        {
          question: 'Что такое ease factor (коэффициент лёгкости)?',
          answer: 'Ease factor определяет, насколько быстро растёт интервал между повторениями для конкретной карточки. Начальное значение 2.5 (интервал удваивается с небольшим запасом). При оценке "Легко" увеличивается на 0.15 (до максимума 2.5), при "Сложно" уменьшается на 0.15 (до минимума 1.3). Таким образом, сложные карточки повторяются чаще, а лёгкие — реже. Это персонализирует обучение под ваши сильные и слабые стороны.'
        },
        {
          question: 'Почему SM-2, а не более новые алгоритмы?',
          answer: 'SM-2 проверен временем и имеет оптимальный баланс между простотой и эффективностью. Более новые алгоритмы (SM-15, SM-17, Anki) сложнее, требуют больше данных и вычислений, но дают лишь незначительное улучшение (5-10%). SM-2 прост, понятен, предсказуем и работает отлично для большинства пользователей.'
        }
      ]
    },
    {
      title: 'Работа с колодами и карточками',
      icon: BookOpen,
      color: 'green',
      questions: [
        {
          question: 'Как создать колоду?',
          answer: 'Перейдите в раздел "Колоды" и нажмите "Создать колоду". Укажите название (обязательно), описание (опционально) и выберите цвет для визуального различия колод. После создания откройте колоду и начните добавлять карточки. Рекомендуется группировать карточки по темам: например, "Английский: неправильные глаголы", "История: даты событий".'
        },
        {
          question: 'Как добавить карточку?',
          answer: 'Откройте нужную колоду и нажмите "Добавить карточку". Заполните лицевую сторону (вопрос/термин) и обратную сторону (ответ/определение). Старайтесь формулировать вопросы чётко и однозначно. Избегайте слишком сложных карточек — лучше разбить на несколько простых. Можно добавлять карточки партиями через импорт (функция в разработке).'
        },
        {
          question: 'Можно ли редактировать карточки?',
          answer: 'Да, откройте колоду, найдите нужную карточку в списке и нажмите иконку редактирования. Вы можете изменить как вопрос, так и ответ в любое время. Изменения не влияют на статистику повторений — интервалы и ease factor сохраняются. Это полезно для исправления опечаток или уточнения формулировок.'
        },
        {
          question: 'Как удалить карточку?',
          answer: 'В списке карточек колоды нажмите на меню (три точки) и выберите "Удалить". Будьте осторожны — удаление необратимо, вся статистика по карточке будет потеряна. Если карточка временно не нужна, лучше приостановите её вместо удаления.'
        },
        {
          question: 'Что такое приостановка карточки?',
          answer: 'Приостановка (suspend) временно исключает карточку из режима обучения. Карточка остаётся в колоде, сохраняет статистику, но не показывается в расписании. Это полезно для карточек, которые вы уже хорошо знаете или которые временно не актуальны. Возобновить показ можно в любой момент.'
        },
        {
          question: 'Как организовать большое количество карточек?',
          answer: 'Создавайте отдельные колоды для разных тем или предметов. Используйте понятные названия и цвета для быстрой навигации. Не делайте колоды слишком большими (рекомендуется до 500 карточек в одной). Лучше 5 колод по 100 карточек, чем одна на 500 — так проще отслеживать прогресс по темам.'
        }
      ]
    },
    {
      title: 'Прогресс и статистика',
      icon: Target,
      color: 'orange',
      questions: [
        {
          question: 'Что такое streak (серия)?',
          answer: 'Streak — это количество дней подряд, когда вы занимались в режиме обучения (не тренировки). Даже одна повторённая карточка в день засчитывает streak. Регулярность критически важна для долгосрочного запоминания — 15 минут каждый день эффективнее, чем 2 часа раз в неделю. Система показывает текущую серию и лучшую (рекорд). Цель — поддерживать streak как можно дольше.'
        },
        {
          question: 'Когда карточка считается освоенной?',
          answer: 'Карточка считается освоенной (mastered) после 3 или более успешных повторений с оценками 2, 3 или 4. Обычно это занимает 20-25 дней при регулярных занятиях (1 день + 6 дней + 15 дней). Освоенные карточки продолжают повторяться, но всё реже. Полное "закрепление" в долговременной памяти происходит после 5-7 повторений на протяжении нескольких месяцев.'
        },
        {
          question: 'Что показывает календарь?',
          answer: 'Календарь отображает запланированные повторения на каждый день месяца. Цвет ячейки (от светло-зелёного до тёмно-зелёного) и число показывают количество карточек на этот день. Серый — нет карточек. Синяя обводка — сегодняшний день. Календарь помогает планировать время: если видите, что завтра 50 карточек — лучше подготовиться заранее.'
        },
        {
          question: 'Что такое расписание на 7 дней?',
          answer: 'Детальное расписание показывает, сколько карточек из каждой колоды нужно повторить в ближайшие 7 дней. Это помогает видеть нагрузку по дням и распределять время. Если какой-то день перегружен, можно заранее сделать часть повторений или временно приостановить новые карточки.'
        },
        {
          question: 'Как работает система уровней?',
          answer: 'За каждое повторение в режиме обучения вы получаете очки: 1-4 в зависимости от оценки. Накопленные очки влияют на ваш уровень (каждые 100 очков = +1 уровень). Уровень — это геймификация для мотивации. Реальный прогресс измеряется количеством освоенных карточек и длительностью streak, но уровни делают процесс веселее.'
        },
        {
          question: 'Где посмотреть детальную статистику?',
          answer: 'В разделе "Статистика" доступны графики изучения по дням, распределение карточек по статусам (новые/изучаемые/освоенные), прогресс по колодам. Вы увидите, какие колоды требуют больше внимания, как меняется ваша эффективность с течением времени, и сколько всего карточек вы повторили.'
        }
      ]
    },
    {
      title: 'Советы по эффективному обучению',
      icon: Zap,
      color: 'yellow',
      questions: [
        {
          question: 'Как часто нужно заниматься?',
          answer: 'Ежедневно по 15-30 минут — это оптимум. Регулярность важнее длительности одной сессии. Мозгу нужно время для консолидации памяти между повторениями. 20 минут каждый день в 10 раз эффективнее, чем 2 часа раз в неделю. Старайтесь заниматься в одно и то же время — это формирует привычку.'
        },
        {
          question: 'Сколько новых карточек добавлять?',
          answer: 'Для начала 5-10 новых карточек в день. По мере привыкания можно увеличить до 20-30. Помните: каждая новая карточка — это будущие повторения. 20 новых карточек сегодня = ~20 повторений завтра + ~20 через неделю + ~20 через месяц. Не перегружайтесь, иначе повторения накопятся и демотивируют. Лучше медленно, но стабильно.'
        },
        {
          question: 'Как правильно оценивать карточки?',
          answer: 'Будьте честны с собой — это ключ к эффективности. "Забыл" (1) — не смогли вспомнить даже после подсказки. "Сложно" (2) — вспомнили, но потребовалось время или подсказка. "Хорошо" (3) — вспомнили без проблем за несколько секунд. "Легко" (4) — ответ пришёл мгновенно, абсолютно уверены. Не завышайте оценки из-за гордости — это обманет алгоритм, и вы быстро забудете материал.'
        },
        {
          question: 'Что делать, если накопилось много карточек?',
          answer: 'Не паникуйте и не пытайтесь повторить всё за раз. Занимайтесь по 30 минут в день, делайте столько, сколько успеваете. Временно приостановите добавление новых карточек — сосредоточьтесь на повторениях. За неделю-две вы наверстаете отставание. Если карточек слишком много (>100 просроченных), лучше приостановить часть колод и сфокусироваться на самых важных.'
        },
        {
          question: 'Как сформулировать хорошую карточку?',
          answer: 'Принцип минимальной информации: одна карточка = одна идея. Вопрос должен быть чётким и однозначным. Ответ — кратким и конкретным. Плохо: "Расскажи о Второй мировой войне" (слишком широко). Хорошо: "В каком году началась Вторая мировая война?" → "1939". Используйте картинки, если это помогает (пока не реализовано, но планируется). Избегайте двусмысленности.'
        },
        {
          question: 'Стоит ли учить всё подряд или фокусироваться?',
          answer: 'Фокус эффективнее распыления. Лучше выучить 100 карточек по одной теме глубоко, чем 500 карточек по 5 темам поверхностно. Мозг лучше запоминает связанную информацию. Сначала доведите одну колоду до 70-80% освоенных карточек, потом добавляйте новую тему. Исключение: если темы совершенно не связаны и вам нужны обе одновременно.'
        },
        {
          question: 'Что если я пропущу несколько дней?',
          answer: 'Не страшно, но постарайтесь минимизировать пропуски. Пропущенные карточки накопятся, но алгоритм учтёт задержку. Когда вернётесь, будет больше повторений — просто занимайтесь по чуть-чуть каждый день, и через неделю всё наладится. Главное — не бросайте полностью. Даже после месячного перерыва лучше продолжить, чем начинать заново.'
        }
      ]
    },
    {
      title: 'Расписание повторений',
      icon: Calendar,
      color: 'indigo',
      questions: [
        {
          question: 'Почему важно повторять в срок?',
          answer: 'Алгоритм планирует повторения точно в момент, когда вы вот-вот забудете информацию (в "точке оптимального забывания"). Повторение в этот момент максимально эффективно укрепляет нейронные связи. Если повторить слишком рано — потратите время впустую. Если слишком поздно — уже забыли, придётся учить заново. Идеально — ±1 день от запланированной даты.'
        },
        {
          question: 'Что будет, если пропустить повторение?',
          answer: 'Карточка останется в очереди "просроченных" и будет показана при следующем занятии. Пропуск на 1-2 дня не критичен — просто повторите, когда сможете. Пропуск на неделю и более снижает эффективность: вероятно, вы уже забыли материал. В этом случае придётся ставить оценку 1-2, и интервал уменьшится или сбросится. Регулярность — основа метода.'
        },
        {
          question: 'Можно ли изменить расписание вручную?',
          answer: 'Нет, расписание формируется автоматически на основе алгоритма SM-2 и ваших оценок. Ручное вмешательство нарушило бы научную обоснованность метода. Единственный способ влиять на расписание — честно оценивать карточки. Если карточка слишком лёгкая — ставьте 4, интервал вырастет быстрее. Если сложная — ставьте 1-2, интервал уменьшится.'
        },
        {
          question: 'Почему некоторые карточки повторяются чаще других?',
          answer: 'Потому что вы оценили их как сложные (1-2), и их ease factor снизился. Алгоритм адаптируется под ваши трудности. Это нормально и правильно: сложный материал требует больше повторений. Как только вы начнёте стабильно ставить 3-4, интервалы вырастут, и карточка будет появляться реже.'
        },
        {
          question: 'Сколько времени занимает полное освоение колоды?',
          answer: 'Зависит от размера колоды и регулярности занятий. Для колоды в 100 карточек при добавлении 10 новых карточек в день и ежедневных повторениях: ~10 дней на добавление всех, ~30-60 дней на достижение 80% освоенных, ~90-120 дней на полное освоение (95%+). Чем чаще занимаетесь и чем лучше помните — тем быстрее. Но не торопитесь: качество важнее скорости.'
        }
      ]
    }
  ];

  const getColorClasses = (color) => {
    const colors = {
      blue: { bg: 'bg-blue-100', text: 'text-blue-600', border: 'border-blue-300', hover: 'hover:border-blue-400' },
      purple: { bg: 'bg-purple-100', text: 'text-purple-600', border: 'border-purple-300', hover: 'hover:border-purple-400' },
      green: { bg: 'bg-green-100', text: 'text-green-600', border: 'border-green-300', hover: 'hover:border-green-400' },
      orange: { bg: 'bg-orange-100', text: 'text-orange-600', border: 'border-orange-300', hover: 'hover:border-orange-400' },
      yellow: { bg: 'bg-yellow-100', text: 'text-yellow-600', border: 'border-yellow-300', hover: 'hover:border-yellow-400' },
      indigo: { bg: 'bg-indigo-100', text: 'text-indigo-600', border: 'border-indigo-300', hover: 'hover:border-indigo-400' }
    };
    return colors[color] || colors.blue;
  };

  return (
    <div className="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
      <div className="space-y-8 max-w-4xl mx-auto">
        <Link to="/" className="inline-flex items-center space-x-2 text-blue-600 hover:text-blue-700 font-medium transition-colors">
          <ArrowLeft size={20} />
          <span>Вернуться на главную</span>
        </Link>

        <div className="text-center space-y-4">
          <div className="flex items-center justify-center">
            <div className="w-16 h-16 bg-blue-500 rounded-2xl flex items-center justify-center shadow-lg">
              <Sparkles className="text-white" size={32} />
            </div>
          </div>
          <h1 className="text-4xl font-bold text-gray-900">Часто задаваемые вопросы</h1>
          <p className="text-lg text-gray-600 max-w-2xl mx-auto">
            Всё, что нужно знать об использовании Memora и научном методе интервального повторения
          </p>
        </div>

        {sections.map((section, sectionIndex) => {
          const colors = getColorClasses(section.color);
          
          return (
            <div key={sectionIndex} className="space-y-4">
              <div className="flex items-center space-x-3">
                <div className={`w-12 h-12 ${colors.bg} rounded-xl flex items-center justify-center shadow-sm`}>
                  <section.icon className={colors.text} size={24} />
                </div>
                <div>
                  <h2 className="text-2xl font-bold text-gray-900">{section.title}</h2>
                  <p className="text-sm text-gray-500">{section.questions.length} вопросов</p>
                </div>
              </div>

              <div className="space-y-3">
                {section.questions.map((item, questionIndex) => {
                  const globalIndex = `${sectionIndex}-${questionIndex}`;
                  const isOpen = openIndex === globalIndex;

                  return (
                    <div
                      key={questionIndex}
                      className={`bg-white rounded-xl p-6 border-2 cursor-pointer transition-all ${
                        isOpen 
                          ? `${colors.border} shadow-lg` 
                          : `border-gray-200 ${colors.hover} hover:shadow-md`
                      }`}
                      onClick={() => toggleQuestion(globalIndex)}
                    >
                      <div className="flex items-start justify-between gap-4">
                        <h3 className="text-lg font-semibold text-gray-900 flex-1">
                          {item.question}
                        </h3>
                        <ChevronDown
                          className={`shrink-0 transition-transform ${
                            isOpen ? 'rotate-180' : ''
                          } ${colors.text}`}
                          size={24}
                        />
                      </div>

                      {isOpen && (
                        <div className="mt-4 pt-4 border-t border-gray-200">
                          <p className="text-gray-700 leading-relaxed whitespace-pre-line">
                            {item.answer}
                          </p>
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>
          );
        })}

        <div className="bg-blue-50 rounded-2xl p-8 border-2 border-blue-200">
          <div className="text-center">
            <Home className="w-12 h-12 text-blue-600 mx-auto mb-4" />
            <h3 className="text-2xl font-bold text-gray-900 mb-3">Готовы начать?</h3>
            <p className="text-gray-600 mb-6 max-w-md mx-auto">
              Откройте для себя эффективное обучение с Memora
            </p>
            <div className="flex flex-col sm:flex-row gap-3 justify-center">
              <Link to="/">
                <button className="bg-white border-2 border-blue-600 text-blue-600 hover:bg-blue-50 font-semibold px-6 py-3 rounded-xl transition-colors w-full sm:w-auto">
                  На главную
                </button>
              </Link>
              <Link to="/register">
                <button className="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-xl transition-colors shadow-lg w-full sm:w-auto">
                  Начать обучение
                </button>
              </Link>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default FAQ;
